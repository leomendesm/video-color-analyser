!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.Vibrant=n():t.Vibrant=n()}(window,function(){return function(e){var r={};function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=r,o.d=function(t,n,e){o.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(n,t){if(1&t&&(n=o(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var e=Object.create(null);if(o.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var r in n)o.d(e,r,function(t){return n[t]}.bind(null,r));return e},o.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(n,"a",n),n},o.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},o.p="",o(o.s=18)}([function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.mapValues=function(t,n){var e={};for(var r in t)if(t.hasOwnProperty(r)){var o=t[r];e[r]=n(o)}return e},n.assignDeep=function r(o){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.forEach(function(t){if(t)for(var n in t)if(t.hasOwnProperty(n)){var e=t[n];Array.isArray(e)?o[n]=e.slice(0):"object"==typeof e?(o[n]||(o[n]={}),r(o[n],e)):o[n]=e}}),o}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e(7),a=e(8),i=e(0),r=function(){function r(t,n){this._src=t,this.opts=i.assignDeep({},r.DefaultOpts,n)}return r.use=function(t){this._pipeline=t},r.from=function(t){return new a.default(t)},Object.defineProperty(r.prototype,"result",{get:function(){return this._result},enumerable:!0,configurable:!0}),r.prototype._process=function(t,n){this.opts.quantizer;t.scaleDown(this.opts);var e=o.buildProcessOptions(this.opts,n);return r._pipeline.process(t.getImageData(),e)},r.prototype.palette=function(){return this.swatches()},r.prototype.swatches=function(){throw new Error("Method deprecated. Use `Vibrant.result.palettes[name]` instead")},r.prototype.getPalette=function(){var n=this,t=arguments[0],e=arguments[1],r="string"==typeof t?t:"default",o="string"==typeof t?e:t,a=new this.opts.ImageClass;return a.load(this._src).then(function(t){return n._process(t,{generators:[r]})}).then(function(t){return(n._result=t).palettes[r]}).then(function(t){return a.remove(),o&&o(void 0,t),t}).catch(function(t){return a.remove(),o&&o(t),Promise.reject(t)})},r.prototype.getPalettes=function(){var n=this,t=arguments[0],e=arguments[1],r=Array.isArray(t)?t:["*"],o=Array.isArray(t)?e:t,a=new this.opts.ImageClass;return a.load(this._src).then(function(t){return n._process(t,{generators:r})}).then(function(t){return(n._result=t).palettes}).then(function(t){return a.remove(),o&&o(void 0,t),t}).catch(function(t){return a.remove(),o&&o(t),Promise.reject(t)})},r.DefaultOpts={colorCount:64,quality:5,filters:[]},r}();n.default=r},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(){}return t.prototype.scaleDown=function(t){var n=this.getWidth(),e=this.getHeight(),r=1;if(0<t.maxDimension){var o=Math.max(n,e);o>t.maxDimension&&(r=t.maxDimension/o)}else r=1/t.quality;r<1&&this.resize(n*r,e*r,r)},t}();n.ImageBase=r,n.applyFilters=function(t,n){if(0<n.length)for(var e=t.data,r=e.length/4,o=void 0,a=void 0,i=void 0,s=void 0,u=void 0,l=0;l<r;l++){a=e[0+(o=4*l)],i=e[o+1],s=e[o+2],u=e[o+3];for(var p=0;p<n.length;p++)if(!n[p](a,i,s,u)){e[o+3]=0;break}}return t}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e(4),r=function(){function n(t,n){this._rgb=t,this._population=n}return n.applyFilters=function(t,a){return 0<a.length?t.filter(function(t){for(var n=t.r,e=t.g,r=t.b,o=0;o<a.length;o++)if(!a[o](n,e,r,255))return!1;return!0}):t},n.clone=function(t){return new n(t._rgb,t._population)},Object.defineProperty(n.prototype,"r",{get:function(){return this._rgb[0]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"g",{get:function(){return this._rgb[1]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"b",{get:function(){return this._rgb[2]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rgb",{get:function(){return this._rgb},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hsl",{get:function(){if(!this._hsl){var t=this._rgb,n=t[0],e=t[1],r=t[2];this._hsl=o.rgbToHsl(n,e,r)}return this._hsl},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hex",{get:function(){if(!this._hex){var t=this._rgb,n=t[0],e=t[1],r=t[2];this._hex=o.rgbToHex(n,e,r)}return this._hex},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"population",{get:function(){return this._population},enumerable:!0,configurable:!0}),n.prototype.toJSON=function(){return{rgb:this.rgb,population:this.population}},n.prototype.getRgb=function(){return this._rgb},n.prototype.getHsl=function(){return this.hsl},n.prototype.getPopulation=function(){return this._population},n.prototype.getHex=function(){return this.hex},n.prototype.getYiq=function(){if(!this._yiq){var t=this._rgb;this._yiq=(299*t[0]+587*t[1]+114*t[2])/1e3}return this._yiq},Object.defineProperty(n.prototype,"titleTextColor",{get:function(){return this._titleTextColor&&(this._titleTextColor=this.getYiq()<200?"#fff":"#000"),this._titleTextColor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bodyTextColor",{get:function(){return this._bodyTextColor&&(this._bodyTextColor=this.getYiq()<150?"#fff":"#000"),this._bodyTextColor},enumerable:!0,configurable:!0}),n.prototype.getTitleTextColor=function(){return this.titleTextColor},n.prototype.getBodyTextColor=function(){return this.bodyTextColor},n}();n.Swatch=r},function(t,n,e){"use strict";function r(t){var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(!n)throw new RangeError("'"+t+"' is not a valid hex color");return[n[1],n[2],n[3]].map(function(t){return parseInt(t,16)})}function o(t,n,e){return n/=255,e/=255,t=.04045<(t/=255)?Math.pow((t+.005)/1.055,2.4):t/12.92,n=.04045<n?Math.pow((n+.005)/1.055,2.4):n/12.92,e=.04045<e?Math.pow((e+.005)/1.055,2.4):e/12.92,[.4124*(t*=100)+.3576*(n*=100)+.1805*(e*=100),.2126*t+.7152*n+.0722*e,.0193*t+.1192*n+.9505*e]}function a(t,n,e){return n/=100,e/=108.883,t=.008856<(t/=95.047)?Math.pow(t,1/3):7.787*t+16/116,[116*(n=.008856<n?Math.pow(n,1/3):7.787*n+16/116)-16,500*(t-n),200*(n-(e=.008856<e?Math.pow(e,1/3):7.787*e+16/116))]}function i(t,n,e){var r=o(t,n,e);return a(r[0],r[1],r[2])}function s(t,n){var e=t[0],r=t[1],o=t[2],a=n[0],i=n[1],s=n[2],u=e-a,l=r-i,p=o-s,c=Math.sqrt(r*r+o*o),f=a-e,_=Math.sqrt(i*i+s*s)-c,h=Math.sqrt(u*u+l*l+p*p),g=Math.sqrt(h)>Math.sqrt(Math.abs(f))+Math.sqrt(Math.abs(_))?Math.sqrt(h*h-f*f-_*_):0;return f/=1,_/=1*(1+.045*c),g/=1*(1+.015*c),Math.sqrt(f*f+_*_+g*g)}function u(t,n){return s(i.apply(void 0,t),i.apply(void 0,n))}Object.defineProperty(n,"__esModule",{value:!0}),n.DELTAE94_DIFF_STATUS={NA:0,PERFECT:1,CLOSE:2,GOOD:10,SIMILAR:50},n.hexToRgb=r,n.rgbToHex=function(t,n,e){return"#"+((1<<24)+(t<<16)+(n<<8)+e).toString(16).slice(1,7)},n.rgbToHsl=function(t,n,e){t/=255,n/=255,e/=255;var r=Math.max(t,n,e),o=Math.min(t,n,e),a=0,i=0,s=(r+o)/2;if(r!==o){var u=r-o;switch(i=.5<s?u/(2-r-o):u/(r+o),r){case t:a=(n-e)/u+(n<e?6:0);break;case n:a=(e-t)/u+2;break;case e:a=(t-n)/u+4}a/=6}return[a,i,s]},n.hslToRgb=function(t,n,e){var r,o,a;function i(t,n,e){return e<0&&(e+=1),1<e&&(e-=1),e<1/6?t+6*(n-t)*e:e<.5?n:e<2/3?t+(n-t)*(2/3-e)*6:t}if(0===n)r=o=a=e;else{var s=e<.5?e*(1+n):e+n-e*n,u=2*e-s;r=i(u,s,t+1/3),o=i(u,s,t),a=i(u,s,t-1/3)}return[255*r,255*o,255*a]},n.rgbToXyz=o,n.xyzToCIELab=a,n.rgbToCIELab=i,n.deltaE94=s,n.rgbDiff=u,n.hexDiff=function(t,n){return u(r(t),r(n))},n.getColorDiffStatus=function(t){return t<n.DELTAE94_DIFF_STATUS.NA?"N/A":t<=n.DELTAE94_DIFF_STATUS.PERFECT?"Perfect":t<=n.DELTAE94_DIFF_STATUS.CLOSE?"Close":t<=n.DELTAE94_DIFF_STATUS.GOOD?"Good":t<n.DELTAE94_DIFF_STATUS.SIMILAR?"Similar":"Wrong"}},function(t,n,e){"use strict";var r=e(6),o=e(9);r.default.DefaultOpts.ImageClass=o.default,t.exports=r.default},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e(1);r.default.DefaultOpts.quantizer="mmcq",r.default.DefaultOpts.generators=["default"],r.default.DefaultOpts.filters=["default"],n.default=r.default},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u=e(0);n.buildProcessOptions=function(t,n){var e=t.colorCount,r=t.quantizer,o=t.generators,a=t.filters,i={colorCount:e},s="string"==typeof r?{name:r,options:{}}:r;return s.options=u.assignDeep({},i,s.options),u.assignDeep({},{quantizer:s,generators:o,filters:a},n)}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e(1),o=e(0),a=function(){function t(t,n){void 0===n&&(n={}),this._src=t,this._opts=o.assignDeep({},r.default.DefaultOpts,n)}return t.prototype.maxColorCount=function(t){return this._opts.colorCount=t,this},t.prototype.maxDimension=function(t){return this._opts.maxDimension=t,this},t.prototype.addFilter=function(t){return this._opts.filters?this._opts.filters.push(t):this._opts.filters=[t],this},t.prototype.removeFilter=function(t){if(this._opts.filters){var n=this._opts.filters.indexOf(t);0<n&&this._opts.filters.splice(n)}return this},t.prototype.clearFilters=function(){return this._opts.filters=[],this},t.prototype.quality=function(t){return this._opts.quality=t,this},t.prototype.useImageClass=function(t){return this._opts.ImageClass=t,this},t.prototype.useGenerator=function(t,n){return this._opts.generators||(this._opts.generators=[]),this._opts.generators.push(n?{name:t,options:n}:t),this},t.prototype.useQuantizer=function(t,n){return this._opts.quantizer=n?{name:t,options:n}:t,this},t.prototype.build=function(){return new r.default(this._src,this._opts)},t.prototype.getPalette=function(t){return this.build().getPalette(t)},t.prototype.getSwatches=function(t){return this.build().getPalette(t)},t}();n.default=a},function(t,n,e){"use strict";var r,o=this&&this.__extends||(r=function(t,n){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)},function(t,n){function e(){this.constructor=t}r(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)});Object.defineProperty(n,"__esModule",{value:!0});var a=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return o(n,t),n.prototype._initCanvas=function(){var t=this.image,n=this._canvas=document.createElement("canvas"),e=n.getContext("2d");if(!e)throw new ReferenceError("Failed to create canvas context");this._context=e,n.className="@vibrant/canvas",n.style.display="none",this._width=n.width=t.width,this._height=n.height=t.height,e.drawImage(t,0,0),document.body.appendChild(n)},n.prototype.load=function(t){var r,o,n,e,a,i,s,u=this;if("string"==typeof t)r=document.createElement("img"),o=t,(s=new URL(o,location.href)).protocol===location.protocol&&s.host===location.host&&s.port===location.port||(n=window.location.href,e=o,a=new URL(n),i=new URL(e),a.protocol===i.protocol&&a.hostname===i.hostname&&a.port===i.port)||(r.crossOrigin="anonymous"),r.src=o;else{if(!(t instanceof HTMLImageElement))return Promise.reject(new Error("Cannot load buffer as an image in browser"));o=(r=t).src}return this.image=r,new Promise(function(t,n){var e=function(){u._initCanvas(),t(u)};r.complete?e():(r.onload=e,r.onerror=function(t){return n(new Error("Fail to load image: "+o))})})},n.prototype.clear=function(){this._context.clearRect(0,0,this._width,this._height)},n.prototype.update=function(t){this._context.putImageData(t,0,0)},n.prototype.getWidth=function(){return this._width},n.prototype.getHeight=function(){return this._height},n.prototype.resize=function(t,n,e){var r=this._canvas,o=this._context,a=this.image;this._width=r.width=t,this._height=r.height=n,o.scale(e,e),o.drawImage(a,0,0)},n.prototype.getPixelCount=function(){return this._width*this._height},n.prototype.getImageData=function(){return this._context.getImageData(0,0,this._width,this._height)},n.prototype.remove=function(){this._canvas&&this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas)},n}(e(2).ImageBase);n.default=a},,,,,,,,,function(t,n,e){"use strict";var r=e(5),o=e(19),a=e(23);r.use(new o.WorkerPipeline(a)),t.exports=r},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e(20),o=e(3),a=e(0),i=function(){function t(t){this.PipelineWorker=t,this._manager=new r.default,this._manager.register("pipeline",t)}return t.prototype._rehydrate=function(t){var n=t.colors,e=t.palettes;return t.colors=n.map(function(t){return o.Swatch.clone(t)}),t.palettes=a.mapValues(e,function(t){return a.mapValues(t,function(t){return t?o.Swatch.clone(t):null})}),t},t.prototype.process=function(t,n){var e=this;return this._manager.invokeWorker("pipeline",[t,n],[t.data.buffer]).then(function(t){return e._rehydrate(t)})},t}();n.WorkerPipeline=i},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e(21),o=function(){function t(){this._pools={}}return t.prototype.register=function(t,n){this._pools[t]=new r.default(n)},t.prototype.hasWorker=function(t){return!!this._pools[t]},t.prototype.getWorker=function(t){return this._pools[t]},t.prototype.invokeWorker=function(t,n,e){return this.hasWorker(t)?this.getWorker(t).invoke(n,e):Promise.reject("Worker '"+t+"' does not exist")},t}();n.default=o},function(t,n,e){"use strict";var o=this&&this.__rest||function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)n.indexOf(r[o])<0&&(e[r[o]]=t[r[o]])}return e};Object.defineProperty(n,"__esModule",{value:!0});var a=e(22),r=function(){function t(t){this.WorkerClass=t,this._taskId=0,this._workers=[],this._queue=[],this._executing={}}return t.prototype._findIdleWorker=function(){var t;return 0===this._workers.length||this._workers.length<5?((t=new this.WorkerClass).id=this._workers.length,t.idle=!0,this._workers.push(t),t.onmessage=this._onMessage.bind(this,t.id)):t=this._workers.find(function(t){return t.idle}),t},t.prototype._enqueue=function(t,n){var e=a.defer(),r={id:this._taskId++,payload:t,transferList:n,deferred:e};return this._queue.push(r),this._tryDequeue(),e.promise},t.prototype._tryDequeue=function(){if(!(this._queue.length<=0)){var t=this._findIdleWorker();if(t){var n=this._queue.shift(),e=(this._executing[n.id]=n).transferList,r=(n.deferred,n.transferList,o(n,["deferred","transferList"]));t.postMessage(r,e),t.idle=!1}}},t.prototype._onMessage=function(t,n){var e=n.data;if(e){var r=e.id,o=this._executing[r];switch(delete this._executing[r],e.type){case"return":o.deferred.resolve(e.payload);break;case"error":o.deferred.reject(new Error(e.payload))}this._workers[t].idle=!0,this._tryDequeue()}},t.prototype.invoke=function(t,n){return this._enqueue(t,n)},t}();n.default=r},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){var e=this;this.promise=new Promise(function(t,n){e.resolve=t,e.reject=n})};n.Defer=r,n.defer=function(){return new r}},function(t,n,e){t.exports=function(){return e(24)('/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tif(typeof Symbol !== \'undefined\' && Symbol.toStringTag) {\n/******/ \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: \'Module\' });\n/******/ \t\t}\n/******/ \t\tObject.defineProperty(exports, \'__esModule\', { value: true });\n/******/ \t};\n/******/\n/******/ \t// create a fake namespace object\n/******/ \t// mode & 1: value is a module id, require it\n/******/ \t// mode & 2: merge all properties of value into the ns\n/******/ \t// mode & 4: return value when already ns object\n/******/ \t// mode & 8|1: behave like require\n/******/ \t__webpack_require__.t = function(value, mode) {\n/******/ \t\tif(mode & 1) value = __webpack_require__(value);\n/******/ \t\tif(mode & 8) return value;\n/******/ \t\tif((mode & 4) && typeof value === \'object\' && value && value.__esModule) return value;\n/******/ \t\tvar ns = Object.create(null);\n/******/ \t\t__webpack_require__.r(ns);\n/******/ \t\tObject.defineProperty(ns, \'default\', { enumerable: true, value: value });\n/******/ \t\tif(mode & 2 && typeof value != \'string\') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n/******/ \t\treturn ns;\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module[\'default\']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, \'a\', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = "";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 2);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n"use strict";\n\nObject.defineProperty(exports, "__esModule", { value: true });\nvar converter_1 = __webpack_require__(1);\nvar Swatch = /** @class */ (function () {\n    function Swatch(rgb, population) {\n        this._rgb = rgb;\n        this._population = population;\n    }\n    Swatch.applyFilters = function (colors, filters) {\n        return filters.length > 0\n            ? colors.filter(function (_a) {\n                var r = _a.r, g = _a.g, b = _a.b;\n                for (var j = 0; j < filters.length; j++) {\n                    if (!filters[j](r, g, b, 255))\n                        return false;\n                }\n                return true;\n            })\n            : colors;\n    };\n    Swatch.clone = function (swatch) {\n        return new Swatch(swatch._rgb, swatch._population);\n    };\n    Object.defineProperty(Swatch.prototype, "r", {\n        get: function () {\n            return this._rgb[0];\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Swatch.prototype, "g", {\n        get: function () {\n            return this._rgb[1];\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Swatch.prototype, "b", {\n        get: function () {\n            return this._rgb[2];\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Swatch.prototype, "rgb", {\n        get: function () {\n            return this._rgb;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Swatch.prototype, "hsl", {\n        get: function () {\n            if (!this._hsl) {\n                var _a = this._rgb, r = _a[0], g = _a[1], b = _a[2];\n                this._hsl = converter_1.rgbToHsl(r, g, b);\n            }\n            return this._hsl;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Swatch.prototype, "hex", {\n        get: function () {\n            if (!this._hex) {\n                var _a = this._rgb, r = _a[0], g = _a[1], b = _a[2];\n                this._hex = converter_1.rgbToHex(r, g, b);\n            }\n            return this._hex;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Swatch.prototype, "population", {\n        get: function () {\n            return this._population;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Swatch.prototype.toJSON = function () {\n        return {\n            rgb: this.rgb,\n            population: this.population\n        };\n    };\n    // TODO: deprecate internally, use property instead\n    Swatch.prototype.getRgb = function () {\n        return this._rgb;\n    };\n    // TODO: deprecate internally, use property instead\n    Swatch.prototype.getHsl = function () {\n        return this.hsl;\n    };\n    // TODO: deprecate internally, use property instead\n    Swatch.prototype.getPopulation = function () {\n        return this._population;\n    };\n    // TODO: deprecate internally, use property instead\n    Swatch.prototype.getHex = function () {\n        return this.hex;\n    };\n    Swatch.prototype.getYiq = function () {\n        if (!this._yiq) {\n            var rgb = this._rgb;\n            this._yiq = (rgb[0] * 299 + rgb[1] * 587 + rgb[2] * 114) / 1000;\n        }\n        return this._yiq;\n    };\n    Object.defineProperty(Swatch.prototype, "titleTextColor", {\n        get: function () {\n            if (this._titleTextColor) {\n                this._titleTextColor = this.getYiq() < 200 ? \'#fff\' : \'#000\';\n            }\n            return this._titleTextColor;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Swatch.prototype, "bodyTextColor", {\n        get: function () {\n            if (this._bodyTextColor) {\n                this._bodyTextColor = this.getYiq() < 150 ? \'#fff\' : \'#000\';\n            }\n            return this._bodyTextColor;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Swatch.prototype.getTitleTextColor = function () {\n        return this.titleTextColor;\n    };\n    Swatch.prototype.getBodyTextColor = function () {\n        return this.bodyTextColor;\n    };\n    return Swatch;\n}());\nexports.Swatch = Swatch;\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n"use strict";\n\nObject.defineProperty(exports, "__esModule", { value: true });\nexports.DELTAE94_DIFF_STATUS = {\n    NA: 0,\n    PERFECT: 1,\n    CLOSE: 2,\n    GOOD: 10,\n    SIMILAR: 50\n};\nfunction hexToRgb(hex) {\n    var m = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n    if (!m)\n        throw new RangeError("\'" + hex + "\' is not a valid hex color");\n    return [m[1], m[2], m[3]].map(function (s) { return parseInt(s, 16); });\n}\nexports.hexToRgb = hexToRgb;\nfunction rgbToHex(r, g, b) {\n    return \'#\' + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1, 7);\n}\nexports.rgbToHex = rgbToHex;\nfunction rgbToHsl(r, g, b) {\n    r /= 255;\n    g /= 255;\n    b /= 255;\n    var max = Math.max(r, g, b);\n    var min = Math.min(r, g, b);\n    var h = 0;\n    var s = 0;\n    var l = (max + min) / 2;\n    if (max !== min) {\n        var d = max - min;\n        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n        switch (max) {\n            case r:\n                h = (g - b) / d + (g < b ? 6 : 0);\n                break;\n            case g:\n                h = (b - r) / d + 2;\n                break;\n            case b:\n                h = (r - g) / d + 4;\n                break;\n        }\n        h /= 6;\n    }\n    return [h, s, l];\n}\nexports.rgbToHsl = rgbToHsl;\nfunction hslToRgb(h, s, l) {\n    var r;\n    var g;\n    var b;\n    function hue2rgb(p, q, t) {\n        if (t < 0)\n            t += 1;\n        if (t > 1)\n            t -= 1;\n        if (t < 1 / 6)\n            return p + (q - p) * 6 * t;\n        if (t < 1 / 2)\n            return q;\n        if (t < 2 / 3)\n            return p + (q - p) * (2 / 3 - t) * 6;\n        return p;\n    }\n    if (s === 0) {\n        r = g = b = l;\n    }\n    else {\n        var q = l < 0.5 ? l * (1 + s) : l + s - (l * s);\n        var p = 2 * l - q;\n        r = hue2rgb(p, q, h + 1 / 3);\n        g = hue2rgb(p, q, h);\n        b = hue2rgb(p, q, h - (1 / 3));\n    }\n    return [\n        r * 255,\n        g * 255,\n        b * 255\n    ];\n}\nexports.hslToRgb = hslToRgb;\nfunction rgbToXyz(r, g, b) {\n    r /= 255;\n    g /= 255;\n    b /= 255;\n    r = r > 0.04045 ? Math.pow((r + 0.005) / 1.055, 2.4) : r / 12.92;\n    g = g > 0.04045 ? Math.pow((g + 0.005) / 1.055, 2.4) : g / 12.92;\n    b = b > 0.04045 ? Math.pow((b + 0.005) / 1.055, 2.4) : b / 12.92;\n    r *= 100;\n    g *= 100;\n    b *= 100;\n    var x = r * 0.4124 + g * 0.3576 + b * 0.1805;\n    var y = r * 0.2126 + g * 0.7152 + b * 0.0722;\n    var z = r * 0.0193 + g * 0.1192 + b * 0.9505;\n    return [x, y, z];\n}\nexports.rgbToXyz = rgbToXyz;\nfunction xyzToCIELab(x, y, z) {\n    var REF_X = 95.047;\n    var REF_Y = 100;\n    var REF_Z = 108.883;\n    x /= REF_X;\n    y /= REF_Y;\n    z /= REF_Z;\n    x = x > 0.008856 ? Math.pow(x, 1 / 3) : 7.787 * x + 16 / 116;\n    y = y > 0.008856 ? Math.pow(y, 1 / 3) : 7.787 * y + 16 / 116;\n    z = z > 0.008856 ? Math.pow(z, 1 / 3) : 7.787 * z + 16 / 116;\n    var L = 116 * y - 16;\n    var a = 500 * (x - y);\n    var b = 200 * (y - z);\n    return [L, a, b];\n}\nexports.xyzToCIELab = xyzToCIELab;\nfunction rgbToCIELab(r, g, b) {\n    var _a = rgbToXyz(r, g, b), x = _a[0], y = _a[1], z = _a[2];\n    return xyzToCIELab(x, y, z);\n}\nexports.rgbToCIELab = rgbToCIELab;\nfunction deltaE94(lab1, lab2) {\n    var WEIGHT_L = 1;\n    var WEIGHT_C = 1;\n    var WEIGHT_H = 1;\n    var L1 = lab1[0], a1 = lab1[1], b1 = lab1[2];\n    var L2 = lab2[0], a2 = lab2[1], b2 = lab2[2];\n    var dL = L1 - L2;\n    var da = a1 - a2;\n    var db = b1 - b2;\n    var xC1 = Math.sqrt(a1 * a1 + b1 * b1);\n    var xC2 = Math.sqrt(a2 * a2 + b2 * b2);\n    var xDL = L2 - L1;\n    var xDC = xC2 - xC1;\n    var xDE = Math.sqrt(dL * dL + da * da + db * db);\n    var xDH = (Math.sqrt(xDE) > Math.sqrt(Math.abs(xDL)) + Math.sqrt(Math.abs(xDC)))\n        ? Math.sqrt(xDE * xDE - xDL * xDL - xDC * xDC)\n        : 0;\n    var xSC = 1 + 0.045 * xC1;\n    var xSH = 1 + 0.015 * xC1;\n    xDL /= WEIGHT_L;\n    xDC /= WEIGHT_C * xSC;\n    xDH /= WEIGHT_H * xSH;\n    return Math.sqrt(xDL * xDL + xDC * xDC + xDH * xDH);\n}\nexports.deltaE94 = deltaE94;\nfunction rgbDiff(rgb1, rgb2) {\n    var lab1 = rgbToCIELab.apply(undefined, rgb1);\n    var lab2 = rgbToCIELab.apply(undefined, rgb2);\n    return deltaE94(lab1, lab2);\n}\nexports.rgbDiff = rgbDiff;\nfunction hexDiff(hex1, hex2) {\n    var rgb1 = hexToRgb(hex1);\n    var rgb2 = hexToRgb(hex2);\n    return rgbDiff(rgb1, rgb2);\n}\nexports.hexDiff = hexDiff;\nfunction getColorDiffStatus(d) {\n    if (d < exports.DELTAE94_DIFF_STATUS.NA) {\n        return \'N/A\';\n    }\n    // Not perceptible by human eyes\n    if (d <= exports.DELTAE94_DIFF_STATUS.PERFECT) {\n        return \'Perfect\';\n    }\n    // Perceptible through close observation\n    if (d <= exports.DELTAE94_DIFF_STATUS.CLOSE) {\n        return \'Close\';\n    }\n    // Perceptible at a glance\n    if (d <= exports.DELTAE94_DIFF_STATUS.GOOD) {\n        return \'Good\';\n    }\n    // Colors are more similar than opposite\n    if (d < exports.DELTAE94_DIFF_STATUS.SIMILAR) {\n        return \'Similar\';\n    }\n    return \'Wrong\';\n}\nexports.getColorDiffStatus = getColorDiffStatus;\n\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n"use strict";\n\nObject.defineProperty(exports, "__esModule", { value: true });\nvar host_1 = __webpack_require__(3);\nvar _1 = __webpack_require__(5);\nhost_1.default(self, _1.default);\n\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n"use strict";\n\nObject.defineProperty(exports, "__esModule", { value: true });\nvar worker_1 = __webpack_require__(4);\nfunction runPipelineInWorker(self, pipeline) {\n    worker_1.default(self, function (imageData, opts) {\n        return pipeline.process(imageData, opts);\n    });\n}\nexports.default = runPipelineInWorker;\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n"use strict";\n\nObject.defineProperty(exports, "__esModule", { value: true });\nfunction runInWorker(self, fn) {\n    self.onmessage = function (event) {\n        var data = event.data;\n        var id = data.id, payload = data.payload;\n        var response;\n        Promise.resolve(fn.apply(void 0, payload))\n            .then(function (ret) {\n            self.postMessage({\n                id: id,\n                type: \'return\',\n                payload: ret\n            });\n        })\n            .catch(function (e) {\n            self.postMessage({\n                id: id,\n                type: \'error\',\n                payload: e.message\n            });\n        });\n    };\n}\nexports.default = runInWorker;\n\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n"use strict";\n\nObject.defineProperty(exports, "__esModule", { value: true });\nvar quantizer_mmcq_1 = __webpack_require__(6);\nvar generator_default_1 = __webpack_require__(10);\nvar pipeline_1 = __webpack_require__(11);\nvar pipeline = new pipeline_1.BasicPipeline()\n    .filter.register(\'default\', function (r, g, b, a) {\n    return a >= 125\n        && !(r > 250 && g > 250 && b > 250);\n})\n    .quantizer.register(\'mmcq\', quantizer_mmcq_1.default)\n    .generator.register(\'default\', generator_default_1.default);\nexports.default = pipeline;\n\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n"use strict";\n\nObject.defineProperty(exports, "__esModule", { value: true });\nvar color_1 = __webpack_require__(0);\nvar vbox_1 = __webpack_require__(7);\nvar pqueue_1 = __webpack_require__(9);\nvar fractByPopulations = 0.75;\nfunction _splitBoxes(pq, target) {\n    var lastSize = pq.size();\n    while (pq.size() < target) {\n        var vbox = pq.pop();\n        if (vbox && vbox.count() > 0) {\n            var _a = vbox.split(), vbox1 = _a[0], vbox2 = _a[1];\n            pq.push(vbox1);\n            if (vbox2 && vbox2.count() > 0)\n                pq.push(vbox2);\n            // No more new boxes, converged\n            if (pq.size() === lastSize) {\n                break;\n            }\n            else {\n                lastSize = pq.size();\n            }\n        }\n        else {\n            break;\n        }\n    }\n}\nvar MMCQ = function (pixels, opts) {\n    if (pixels.length === 0 || opts.colorCount < 2 || opts.colorCount > 256) {\n        throw new Error(\'Wrong MMCQ parameters\');\n    }\n    var vbox = vbox_1.default.build(pixels);\n    var colorCount = vbox.histogram.colorCount;\n    var pq = new pqueue_1.default(function (a, b) { return a.count() - b.count(); });\n    pq.push(vbox);\n    // first set of colors, sorted by population\n    _splitBoxes(pq, fractByPopulations * opts.colorCount);\n    // Re-order\n    var pq2 = new pqueue_1.default(function (a, b) { return a.count() * a.volume() - b.count() * b.volume(); });\n    pq2.contents = pq.contents;\n    // next set - generate the median cuts using the (npix * vol) sorting.\n    _splitBoxes(pq2, opts.colorCount - pq2.size());\n    // calculate the actual colors\n    return generateSwatches(pq2);\n};\nfunction generateSwatches(pq) {\n    var swatches = [];\n    while (pq.size()) {\n        var v = pq.pop();\n        var color = v.avg();\n        var r = color[0], g = color[1], b = color[2];\n        swatches.push(new color_1.Swatch(color, v.count()));\n    }\n    return swatches;\n}\nexports.default = MMCQ;\n\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports, __webpack_require__) {\n\n"use strict";\n\nObject.defineProperty(exports, "__esModule", { value: true });\nvar histogram_1 = __webpack_require__(8);\nvar SIGBITS = 5;\nvar RSHIFT = 8 - SIGBITS;\nvar VBox = /** @class */ (function () {\n    function VBox(r1, r2, g1, g2, b1, b2, histogram) {\n        this.histogram = histogram;\n        this._volume = -1;\n        this._count = -1;\n        // NOTE: dimension will be mutated by split operation.\n        //       It must be specified explicitly, not from histogram\n        this.dimension = { r1: r1, r2: r2, g1: g1, g2: g2, b1: b1, b2: b2 };\n    }\n    VBox.build = function (pixels) {\n        var h = new histogram_1.default(pixels, { sigBits: SIGBITS });\n        var rmin = h.rmin, rmax = h.rmax, gmin = h.gmin, gmax = h.gmax, bmin = h.bmin, bmax = h.bmax;\n        return new VBox(rmin, rmax, gmin, gmax, bmin, bmax, h);\n    };\n    VBox.prototype.invalidate = function () {\n        this._volume = this._count = -1;\n        this._avg = null;\n    };\n    VBox.prototype.volume = function () {\n        if (this._volume < 0) {\n            var _a = this.dimension, r1 = _a.r1, r2 = _a.r2, g1 = _a.g1, g2 = _a.g2, b1 = _a.b1, b2 = _a.b2;\n            this._volume = (r2 - r1 + 1) * (g2 - g1 + 1) * (b2 - b1 + 1);\n        }\n        return this._volume;\n    };\n    VBox.prototype.count = function () {\n        if (this._count < 0) {\n            var _a = this.histogram, hist = _a.hist, getColorIndex = _a.getColorIndex;\n            var _b = this.dimension, r1 = _b.r1, r2 = _b.r2, g1 = _b.g1, g2 = _b.g2, b1 = _b.b1, b2 = _b.b2;\n            var c = 0;\n            for (var r = r1; r <= r2; r++) {\n                for (var g = g1; g <= g2; g++) {\n                    for (var b = b1; b <= b2; b++) {\n                        var index = getColorIndex(r, g, b);\n                        c += hist[index];\n                    }\n                }\n            }\n            this._count = c;\n        }\n        return this._count;\n    };\n    VBox.prototype.clone = function () {\n        var histogram = this.histogram;\n        var _a = this.dimension, r1 = _a.r1, r2 = _a.r2, g1 = _a.g1, g2 = _a.g2, b1 = _a.b1, b2 = _a.b2;\n        return new VBox(r1, r2, g1, g2, b1, b2, histogram);\n    };\n    VBox.prototype.avg = function () {\n        if (!this._avg) {\n            var _a = this.histogram, hist = _a.hist, getColorIndex = _a.getColorIndex;\n            var _b = this.dimension, r1 = _b.r1, r2 = _b.r2, g1 = _b.g1, g2 = _b.g2, b1 = _b.b1, b2 = _b.b2;\n            var ntot = 0;\n            var mult = 1 << (8 - SIGBITS);\n            var rsum = void 0;\n            var gsum = void 0;\n            var bsum = void 0;\n            rsum = gsum = bsum = 0;\n            for (var r = r1; r <= r2; r++) {\n                for (var g = g1; g <= g2; g++) {\n                    for (var b = b1; b <= b2; b++) {\n                        var index = getColorIndex(r, g, b);\n                        var h = hist[index];\n                        ntot += h;\n                        rsum += (h * (r + 0.5) * mult);\n                        gsum += (h * (g + 0.5) * mult);\n                        bsum += (h * (b + 0.5) * mult);\n                    }\n                }\n            }\n            if (ntot) {\n                this._avg = [\n                    ~~(rsum / ntot),\n                    ~~(gsum / ntot),\n                    ~~(bsum / ntot)\n                ];\n            }\n            else {\n                this._avg = [\n                    ~~(mult * (r1 + r2 + 1) / 2),\n                    ~~(mult * (g1 + g2 + 1) / 2),\n                    ~~(mult * (b1 + b2 + 1) / 2)\n                ];\n            }\n        }\n        return this._avg;\n    };\n    VBox.prototype.contains = function (rgb) {\n        var r = rgb[0], g = rgb[1], b = rgb[2];\n        var _a = this.dimension, r1 = _a.r1, r2 = _a.r2, g1 = _a.g1, g2 = _a.g2, b1 = _a.b1, b2 = _a.b2;\n        r >>= RSHIFT;\n        g >>= RSHIFT;\n        b >>= RSHIFT;\n        return r >= r1 && r <= r2\n            && g >= g1 && g <= g2\n            && b >= b1 && b <= b2;\n    };\n    VBox.prototype.split = function () {\n        var _a = this.histogram, hist = _a.hist, getColorIndex = _a.getColorIndex;\n        var _b = this.dimension, r1 = _b.r1, r2 = _b.r2, g1 = _b.g1, g2 = _b.g2, b1 = _b.b1, b2 = _b.b2;\n        var count = this.count();\n        if (!count)\n            return [];\n        if (count === 1)\n            return [this.clone()];\n        var rw = r2 - r1 + 1;\n        var gw = g2 - g1 + 1;\n        var bw = b2 - b1 + 1;\n        var maxw = Math.max(rw, gw, bw);\n        var accSum = null;\n        var sum;\n        var total;\n        sum = total = 0;\n        var maxd = null;\n        if (maxw === rw) {\n            maxd = \'r\';\n            accSum = new Uint32Array(r2 + 1);\n            for (var r = r1; r <= r2; r++) {\n                sum = 0;\n                for (var g = g1; g <= g2; g++) {\n                    for (var b = b1; b <= b2; b++) {\n                        var index = getColorIndex(r, g, b);\n                        sum += hist[index];\n                    }\n                }\n                total += sum;\n                accSum[r] = total;\n            }\n        }\n        else if (maxw === gw) {\n            maxd = \'g\';\n            accSum = new Uint32Array(g2 + 1);\n            for (var g = g1; g <= g2; g++) {\n                sum = 0;\n                for (var r = r1; r <= r2; r++) {\n                    for (var b = b1; b <= b2; b++) {\n                        var index = getColorIndex(r, g, b);\n                        sum += hist[index];\n                    }\n                }\n                total += sum;\n                accSum[g] = total;\n            }\n        }\n        else {\n            maxd = \'b\';\n            accSum = new Uint32Array(b2 + 1);\n            for (var b = b1; b <= b2; b++) {\n                sum = 0;\n                for (var r = r1; r <= r2; r++) {\n                    for (var g = g1; g <= g2; g++) {\n                        var index = getColorIndex(r, g, b);\n                        sum += hist[index];\n                    }\n                }\n                total += sum;\n                accSum[b] = total;\n            }\n        }\n        var splitPoint = -1;\n        var reverseSum = new Uint32Array(accSum.length);\n        for (var i = 0; i < accSum.length; i++) {\n            var d = accSum[i];\n            if (splitPoint < 0 && d > total / 2)\n                splitPoint = i;\n            reverseSum[i] = total - d;\n        }\n        var vbox = this;\n        function doCut(d) {\n            var dim1 = d + \'1\';\n            var dim2 = d + \'2\';\n            var d1 = vbox.dimension[dim1];\n            var d2 = vbox.dimension[dim2];\n            var vbox1 = vbox.clone();\n            var vbox2 = vbox.clone();\n            var left = splitPoint - d1;\n            var right = d2 - splitPoint;\n            if (left <= right) {\n                d2 = Math.min(d2 - 1, ~~(splitPoint + right / 2));\n                d2 = Math.max(0, d2);\n            }\n            else {\n                d2 = Math.max(d1, ~~(splitPoint - 1 - left / 2));\n                d2 = Math.min(vbox.dimension[dim2], d2);\n            }\n            while (!accSum[d2])\n                d2++;\n            var c2 = reverseSum[d2];\n            while (!c2 && accSum[d2 - 1])\n                c2 = reverseSum[--d2];\n            vbox1.dimension[dim2] = d2;\n            vbox2.dimension[dim1] = d2 + 1;\n            return [vbox1, vbox2];\n        }\n        return doCut(maxd);\n    };\n    return VBox;\n}());\nexports.default = VBox;\n\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports, __webpack_require__) {\n\n"use strict";\n\nObject.defineProperty(exports, "__esModule", { value: true });\nvar Histogram = /** @class */ (function () {\n    function Histogram(pixels, opts) {\n        this.pixels = pixels;\n        this.opts = opts;\n        var sigBits = opts.sigBits;\n        var getColorIndex = function (r, g, b) {\n            return (r << (2 * sigBits)) + (g << sigBits) + b;\n        };\n        this.getColorIndex = getColorIndex;\n        var rshift = 8 - sigBits;\n        var hn = 1 << (3 * sigBits);\n        var hist = new Uint32Array(hn);\n        var rmax;\n        var rmin;\n        var gmax;\n        var gmin;\n        var bmax;\n        var bmin;\n        var r;\n        var g;\n        var b;\n        var a;\n        rmax = gmax = bmax = 0;\n        rmin = gmin = bmin = Number.MAX_VALUE;\n        var n = pixels.length / 4;\n        var i = 0;\n        while (i < n) {\n            var offset = i * 4;\n            i++;\n            r = pixels[offset + 0];\n            g = pixels[offset + 1];\n            b = pixels[offset + 2];\n            a = pixels[offset + 3];\n            // Ignored pixels\' alpha is marked as 0 in filtering stage\n            if (a === 0)\n                continue;\n            r = r >> rshift;\n            g = g >> rshift;\n            b = b >> rshift;\n            var index = getColorIndex(r, g, b);\n            hist[index] += 1;\n            if (r > rmax)\n                rmax = r;\n            if (r < rmin)\n                rmin = r;\n            if (g > gmax)\n                gmax = g;\n            if (g < gmin)\n                gmin = g;\n            if (b > bmax)\n                bmax = b;\n            if (b < bmin)\n                bmin = b;\n        }\n        this._colorCount = hist.reduce(function (total, c) { return c > 0 ? total + 1 : total; }, 0);\n        this.hist = hist;\n        this.rmax = rmax;\n        this.rmin = rmin;\n        this.gmax = gmax;\n        this.gmin = gmin;\n        this.bmax = bmax;\n        this.bmin = bmin;\n    }\n    Object.defineProperty(Histogram.prototype, "colorCount", {\n        get: function () { return this._colorCount; },\n        enumerable: true,\n        configurable: true\n    });\n    return Histogram;\n}());\nexports.default = Histogram;\n\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports, __webpack_require__) {\n\n"use strict";\n\nObject.defineProperty(exports, "__esModule", { value: true });\nvar PQueue = /** @class */ (function () {\n    function PQueue(comparator) {\n        this._comparator = comparator;\n        this.contents = [];\n        this._sorted = false;\n    }\n    PQueue.prototype._sort = function () {\n        if (!this._sorted) {\n            this.contents.sort(this._comparator);\n            this._sorted = true;\n        }\n    };\n    PQueue.prototype.push = function (item) {\n        this.contents.push(item);\n        this._sorted = false;\n    };\n    PQueue.prototype.peek = function (index) {\n        this._sort();\n        index = typeof index === \'number\' ? index : this.contents.length - 1;\n        return this.contents[index];\n    };\n    PQueue.prototype.pop = function () {\n        this._sort();\n        return this.contents.pop();\n    };\n    PQueue.prototype.size = function () {\n        return this.contents.length;\n    };\n    PQueue.prototype.map = function (mapper) {\n        this._sort();\n        return this.contents.map(mapper);\n    };\n    return PQueue;\n}());\nexports.default = PQueue;\n\n\n/***/ }),\n/* 10 */\n/***/ (function(module, exports, __webpack_require__) {\n\n"use strict";\n\nObject.defineProperty(exports, "__esModule", { value: true });\nvar color_1 = __webpack_require__(0);\nvar converter_1 = __webpack_require__(1);\nvar DefaultOpts = {\n    targetDarkLuma: 0.26,\n    maxDarkLuma: 0.45,\n    minLightLuma: 0.55,\n    targetLightLuma: 0.74,\n    minNormalLuma: 0.3,\n    targetNormalLuma: 0.5,\n    maxNormalLuma: 0.7,\n    targetMutesSaturation: 0.3,\n    maxMutesSaturation: 0.4,\n    targetVibrantSaturation: 1.0,\n    minVibrantSaturation: 0.35,\n    weightSaturation: 3,\n    weightLuma: 6.5,\n    weightPopulation: 0.5\n};\nfunction _findMaxPopulation(swatches) {\n    var p = 0;\n    swatches.forEach(function (s) {\n        p = Math.max(p, s.getPopulation());\n    });\n    return p;\n}\nfunction _isAlreadySelected(palette, s) {\n    return palette.Vibrant === s\n        || palette.DarkVibrant === s\n        || palette.LightVibrant === s\n        || palette.Muted === s\n        || palette.DarkMuted === s\n        || palette.LightMuted === s;\n}\nfunction _createComparisonValue(saturation, targetSaturation, luma, targetLuma, population, maxPopulation, opts) {\n    function weightedMean() {\n        var values = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            values[_i] = arguments[_i];\n        }\n        var sum = 0;\n        var weightSum = 0;\n        for (var i = 0; i < values.length; i += 2) {\n            var value = values[i];\n            var weight = values[i + 1];\n            sum += value * weight;\n            weightSum += weight;\n        }\n        return sum / weightSum;\n    }\n    function invertDiff(value, targetValue) {\n        return 1 - Math.abs(value - targetValue);\n    }\n    return weightedMean(invertDiff(saturation, targetSaturation), opts.weightSaturation, invertDiff(luma, targetLuma), opts.weightLuma, population / maxPopulation, opts.weightPopulation);\n}\nfunction _findColorVariation(palette, swatches, maxPopulation, targetLuma, minLuma, maxLuma, targetSaturation, minSaturation, maxSaturation, opts) {\n    var max = null;\n    var maxValue = 0;\n    swatches.forEach(function (swatch) {\n        var _a = swatch.getHsl(), s = _a[1], l = _a[2];\n        if (s >= minSaturation && s <= maxSaturation\n            && l >= minLuma && l <= maxLuma\n            && !_isAlreadySelected(palette, swatch)) {\n            var value = _createComparisonValue(s, targetSaturation, l, targetLuma, swatch.getPopulation(), maxPopulation, opts);\n            if (max === null || value > maxValue) {\n                max = swatch;\n                maxValue = value;\n            }\n        }\n    });\n    return max;\n}\nfunction _generateVariationColors(swatches, maxPopulation, opts) {\n    var palette = {\n        Vibrant: null,\n        DarkVibrant: null,\n        LightVibrant: null,\n        Muted: null,\n        DarkMuted: null,\n        LightMuted: null\n    };\n    // mVibrantSwatch = findColor(TARGET_NORMAL_LUMA, MIN_NORMAL_LUMA, MAX_NORMAL_LUMA,\n    //     TARGET_VIBRANT_SATURATION, MIN_VIBRANT_SATURATION, 1f)\n    palette.Vibrant = _findColorVariation(palette, swatches, maxPopulation, opts.targetNormalLuma, opts.minNormalLuma, opts.maxNormalLuma, opts.targetVibrantSaturation, opts.minVibrantSaturation, 1, opts);\n    // mLightVibrantSwatch = findColor(TARGET_LIGHT_LUMA, MIN_LIGHT_LUMA, 1f,\n    //     TARGET_VIBRANT_SATURATION, MIN_VIBRANT_SATURATION, 1f)\n    palette.LightVibrant = _findColorVariation(palette, swatches, maxPopulation, opts.targetLightLuma, opts.minLightLuma, 1, opts.targetVibrantSaturation, opts.minVibrantSaturation, 1, opts);\n    // mDarkVibrantSwatch = findColor(TARGET_DARK_LUMA, 0f, MAX_DARK_LUMA,\n    //     TARGET_VIBRANT_SATURATION, MIN_VIBRANT_SATURATION, 1f)\n    palette.DarkVibrant = _findColorVariation(palette, swatches, maxPopulation, opts.targetDarkLuma, 0, opts.maxDarkLuma, opts.targetVibrantSaturation, opts.minVibrantSaturation, 1, opts);\n    // mMutedSwatch = findColor(TARGET_NORMAL_LUMA, MIN_NORMAL_LUMA, MAX_NORMAL_LUMA,\n    //     TARGET_MUTED_SATURATION, 0f, MAX_MUTED_SATURATION)\n    palette.Muted = _findColorVariation(palette, swatches, maxPopulation, opts.targetNormalLuma, opts.minNormalLuma, opts.maxNormalLuma, opts.targetMutesSaturation, 0, opts.maxMutesSaturation, opts);\n    // mLightMutedColor = findColor(TARGET_LIGHT_LUMA, MIN_LIGHT_LUMA, 1f,\n    //     TARGET_MUTED_SATURATION, 0f, MAX_MUTED_SATURATION)\n    palette.LightMuted = _findColorVariation(palette, swatches, maxPopulation, opts.targetLightLuma, opts.minLightLuma, 1, opts.targetMutesSaturation, 0, opts.maxMutesSaturation, opts);\n    // mDarkMutedSwatch = findColor(TARGET_DARK_LUMA, 0f, MAX_DARK_LUMA,\n    //     TARGET_MUTED_SATURATION, 0f, MAX_MUTED_SATURATION)\n    palette.DarkMuted = _findColorVariation(palette, swatches, maxPopulation, opts.targetDarkLuma, 0, opts.maxDarkLuma, opts.targetMutesSaturation, 0, opts.maxMutesSaturation, opts);\n    return palette;\n}\nfunction _generateEmptySwatches(palette, maxPopulation, opts) {\n    if (!palette.Vibrant && !palette.DarkVibrant && !palette.LightVibrant) {\n        if (!palette.DarkVibrant && palette.DarkMuted) {\n            var _a = palette.DarkMuted.getHsl(), h = _a[0], s = _a[1], l = _a[2];\n            l = opts.targetDarkLuma;\n            palette.DarkVibrant = new color_1.Swatch(converter_1.hslToRgb(h, s, l), 0);\n        }\n        if (!palette.LightVibrant && palette.LightMuted) {\n            var _b = palette.LightMuted.getHsl(), h = _b[0], s = _b[1], l = _b[2];\n            l = opts.targetDarkLuma;\n            palette.DarkVibrant = new color_1.Swatch(converter_1.hslToRgb(h, s, l), 0);\n        }\n    }\n    if (!palette.Vibrant && palette.DarkVibrant) {\n        var _c = palette.DarkVibrant.getHsl(), h = _c[0], s = _c[1], l = _c[2];\n        l = opts.targetNormalLuma;\n        palette.Vibrant = new color_1.Swatch(converter_1.hslToRgb(h, s, l), 0);\n    }\n    else if (!palette.Vibrant && palette.LightVibrant) {\n        var _d = palette.LightVibrant.getHsl(), h = _d[0], s = _d[1], l = _d[2];\n        l = opts.targetNormalLuma;\n        palette.Vibrant = new color_1.Swatch(converter_1.hslToRgb(h, s, l), 0);\n    }\n    if (!palette.DarkVibrant && palette.Vibrant) {\n        var _e = palette.Vibrant.getHsl(), h = _e[0], s = _e[1], l = _e[2];\n        l = opts.targetDarkLuma;\n        palette.DarkVibrant = new color_1.Swatch(converter_1.hslToRgb(h, s, l), 0);\n    }\n    if (!palette.LightVibrant && palette.Vibrant) {\n        var _f = palette.Vibrant.getHsl(), h = _f[0], s = _f[1], l = _f[2];\n        l = opts.targetLightLuma;\n        palette.LightVibrant = new color_1.Swatch(converter_1.hslToRgb(h, s, l), 0);\n    }\n    if (!palette.Muted && palette.Vibrant) {\n        var _g = palette.Vibrant.getHsl(), h = _g[0], s = _g[1], l = _g[2];\n        l = opts.targetMutesSaturation;\n        palette.Muted = new color_1.Swatch(converter_1.hslToRgb(h, s, l), 0);\n    }\n    if (!palette.DarkMuted && palette.DarkVibrant) {\n        var _h = palette.DarkVibrant.getHsl(), h = _h[0], s = _h[1], l = _h[2];\n        l = opts.targetMutesSaturation;\n        palette.DarkMuted = new color_1.Swatch(converter_1.hslToRgb(h, s, l), 0);\n    }\n    if (!palette.LightMuted && palette.LightVibrant) {\n        var _j = palette.LightVibrant.getHsl(), h = _j[0], s = _j[1], l = _j[2];\n        l = opts.targetMutesSaturation;\n        palette.LightMuted = new color_1.Swatch(converter_1.hslToRgb(h, s, l), 0);\n    }\n}\nvar DefaultGenerator = function (swatches, opts) {\n    opts = Object.assign({}, DefaultOpts, opts);\n    var maxPopulation = _findMaxPopulation(swatches);\n    var palette = _generateVariationColors(swatches, maxPopulation, opts);\n    _generateEmptySwatches(palette, maxPopulation, opts);\n    return palette;\n};\nexports.default = DefaultGenerator;\n\n\n/***/ }),\n/* 11 */\n/***/ (function(module, exports, __webpack_require__) {\n\n"use strict";\n\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError("Generator is already executing.");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, "__esModule", { value: true });\nvar image_1 = __webpack_require__(12);\nvar Stage = /** @class */ (function () {\n    function Stage(pipeline) {\n        this.pipeline = pipeline;\n        this._map = {};\n    }\n    Stage.prototype.names = function () {\n        return Object.keys(this._map);\n    };\n    Stage.prototype.has = function (name) {\n        return !!this._map[name];\n    };\n    Stage.prototype.get = function (name) {\n        return this._map[name];\n    };\n    Stage.prototype.register = function (name, stageFn) {\n        this._map[name] = stageFn;\n        return this.pipeline;\n    };\n    return Stage;\n}());\nexports.Stage = Stage;\nvar BasicPipeline = /** @class */ (function () {\n    function BasicPipeline() {\n        this.filter = new Stage(this);\n        this.quantizer = new Stage(this);\n        this.generator = new Stage(this);\n    }\n    BasicPipeline.prototype._buildProcessTasks = function (_a) {\n        var _this = this;\n        var filters = _a.filters, quantizer = _a.quantizer, generators = _a.generators;\n        // Support wildcard for generators\n        if (generators.length === 1 && generators[0] === \'*\') {\n            generators = this.generator.names();\n        }\n        return {\n            filters: filters.map(function (f) { return createTask(_this.filter, f); }),\n            quantizer: createTask(this.quantizer, quantizer),\n            generators: generators.map(function (g) { return createTask(_this.generator, g); })\n        };\n        function createTask(stage, o) {\n            var name;\n            var options;\n            if (typeof o === \'string\') {\n                name = o;\n            }\n            else {\n                name = o.name;\n                options = o.options;\n            }\n            return {\n                name: name,\n                fn: stage.get(name),\n                options: options\n            };\n        }\n    };\n    BasicPipeline.prototype.process = function (imageData, opts) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, filters, quantizer, generators, imageFilterData, colors, palettes;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this._buildProcessTasks(opts), filters = _a.filters, quantizer = _a.quantizer, generators = _a.generators;\n                        return [4 /*yield*/, this._filterColors(filters, imageData)];\n                    case 1:\n                        imageFilterData = _b.sent();\n                        return [4 /*yield*/, this._generateColors(quantizer, imageFilterData)];\n                    case 2:\n                        colors = _b.sent();\n                        return [4 /*yield*/, this._generatePalettes(generators, colors)];\n                    case 3:\n                        palettes = _b.sent();\n                        return [2 /*return*/, {\n                                colors: colors,\n                                palettes: palettes\n                            }];\n                }\n            });\n        });\n    };\n    BasicPipeline.prototype._filterColors = function (filters, imageData) {\n        return Promise.resolve(image_1.applyFilters(imageData, filters.map(function (_a) {\n            var fn = _a.fn;\n            return fn;\n        })));\n    };\n    BasicPipeline.prototype._generateColors = function (quantizer, imageData) {\n        return Promise.resolve(quantizer.fn(imageData.data, quantizer.options));\n    };\n    BasicPipeline.prototype._generatePalettes = function (generators, colors) {\n        return __awaiter(this, void 0, void 0, function () {\n            var promiseArr;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, Promise.all(generators.map(function (_a) {\n                            var fn = _a.fn, options = _a.options;\n                            return Promise.resolve(fn(colors, options));\n                        }))\n                        // Map the values to the expected name\n                    ];\n                    case 1:\n                        promiseArr = _a.sent();\n                        // Map the values to the expected name\n                        return [2 /*return*/, Promise.resolve(promiseArr.reduce(function (promises, promiseVal, i) {\n                                promises[generators[i].name] = promiseVal;\n                                return promises;\n                            }, {}))];\n                }\n            });\n        });\n    };\n    return BasicPipeline;\n}());\nexports.BasicPipeline = BasicPipeline;\n\n\n/***/ }),\n/* 12 */\n/***/ (function(module, exports, __webpack_require__) {\n\n"use strict";\n\nObject.defineProperty(exports, "__esModule", { value: true });\nvar ImageBase = /** @class */ (function () {\n    function ImageBase() {\n    }\n    ImageBase.prototype.scaleDown = function (opts) {\n        var width = this.getWidth();\n        var height = this.getHeight();\n        var ratio = 1;\n        if (opts.maxDimension > 0) {\n            var maxSide = Math.max(width, height);\n            if (maxSide > opts.maxDimension)\n                ratio = opts.maxDimension / maxSide;\n        }\n        else {\n            ratio = 1 / opts.quality;\n        }\n        if (ratio < 1)\n            this.resize(width * ratio, height * ratio, ratio);\n    };\n    return ImageBase;\n}());\nexports.ImageBase = ImageBase;\nfunction applyFilters(imageData, filters) {\n    if (filters.length > 0) {\n        var pixels = imageData.data;\n        var n = pixels.length / 4;\n        var offset = void 0;\n        var r = void 0;\n        var g = void 0;\n        var b = void 0;\n        var a = void 0;\n        for (var i = 0; i < n; i++) {\n            offset = i * 4;\n            r = pixels[offset + 0];\n            g = pixels[offset + 1];\n            b = pixels[offset + 2];\n            a = pixels[offset + 3];\n            // Mark ignored color\n            for (var j = 0; j < filters.length; j++) {\n                if (!filters[j](r, g, b, a)) {\n                    pixels[offset + 3] = 0;\n                    break;\n                }\n            }\n        }\n    }\n    return imageData;\n}\nexports.applyFilters = applyFilters;\n\n\n/***/ })\n/******/ ]);\n//# sourceMappingURL=156f7c207b4805a97c3e.worker.js.map',e.p+"156f7c207b4805a97c3e.worker.js")}},function(t,n,e){"use strict";var o=window.URL||window.webkitURL;t.exports=function(n,e){try{try{var r;try{(r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(n),r=r.getBlob()}catch(t){r=new Blob([n])}return new Worker(o.createObjectURL(r))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(n))}}catch(t){if(!e)throw Error("Inline worker is not supported");return new Worker(e)}}}])});